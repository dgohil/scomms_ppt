---
title       : Social CoMMs
subtitle    : Community Based Management and Monitoring System
author      : Deepali Gohil
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow     # 
biglogo     : NRTlogo_highres.jpg
widgets     : [mathjax, quiz, bootstrap] # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
ext_widgets : {rCharts: libraries/nvd3} 

--- #myslide

<div>
<iframe src="https://dgohil.shinyapps.io/map_app/", width=500, height=800></iframe>
</div>

## Map of NRT Conservancies

--- &vcenter

## NRT's Mission Statement
<style>
ol {
  line-height: 5em;
}
content {
  font-family: bold;
  margin-bottom: 20px;
  color: red;
  font-size: 24px;
}
p.red {
  color:  #A00F0F;
  font-size: 40px;
}
</style>

.red **To develop resilient community conservancies that transform lives, secure peace, and conserve natural resources.**

--- 

## Community Conservancies

**Lands that are collectively owned and managed by the resident indigenous communities are being set aside for wildlife conservation and sustainable livestock practices.**

-The Need
>  - Frequent Drought
>  - Sparse Government Services
>  - Degraded Rangelands and Poor Livestock Production
>  - Security Issues
>   - Cattle Rustling
>   - Ivory Poaching
>   - Ethnic rivalries
  
**Peace and Security Needed for Livelihood Development, Protection of Wildlife and Growth of the Region.**

--- &carousel

## Management Hierachies

*** {class: active, img: "assets/img/nrtorgan.jpg"}
NRT Organgram

*** {img: "assets/img/Slide1.tiff"}
Conservancy Organogram

--- 

## Community Monitoring and Management Systems (COMMS)

- Types
  - Wildlife
  - Vegetation
  - Socio-economic
- Devolved
- Easy to Understand
- Monthly Reporting
- Adaptive Mangement

**Adaptive management is a systematic approach for improving resource management by learning from management outcomes.**

--- &twocol #pilot

## Piloting Social COMMS

*** =left
**Pilot Conservancies**

```{r scomms_pilot, echo=FALSE, comment=FALSE, results='asis',message=FALSE, cache=TRUE, warning=FALSE}
library(rgdal)
library(sp)
scomms_pilot <- readOGR("data/nrt_centre.shp", layer="nrt_centre", verbose=FALSE)
scomms_pilot$pilot <- as.factor(scomms_pilot$pilot)
scomms_pilot@data$colour <- "#FFFFFF"
scomms_pilot@data$colour[(as.numeric(scomms_pilot@data$pilot) %% 10) == 1] <- "#FFFFCC"
scomms_pilot@data$colour[(as.numeric(scomms_pilot@data$pilot) %% 10) == 2] <- "#006837"
scomms_pilot@data$colour[(as.numeric(scomms_pilot@data$pilot) %% 10) == 3] <- "#31A354"
p1 <- plot(scomms_pilot, col=scomms_pilot$colour, border=NA)
legend("topleft", legend=c("2016","2014","2015"),title="Legend", bty="n",inset=0.05, lty=c( -1,-2,-1), pch=c(15,15,15), col=c("#FFFFCC","#006837","#31A354"))
```

*** =right 
**Progress**
- Pilot
 - 2014
   - 4 Conservancies
   - Test
   - Each NRT County
   - ~1200 Households    
 - 2015
   - 6 Conservancies 
 - Automated Reporting
  - 3 levels
    - Conservancy & Wards
    - County
    - NRT   
 - Seasonal (Wet Season)
 
 <style>#pilot li{font-size: 80%}</style>

--- &twocol #sample

***=left
**Sera Sample**

![sample](assets/img/sample_example.png)

```{r sera_sample, results='asis', eval=FALSE,echo=FALSE, comment=FALSE, warning=FALSE, cache=TRUE,message=FALSE}
sera <- read.csv("data/sample_example.csv")
library(xtable)
sera <- data.table(sera)
#rownames(sera)[c(2,8)] <- paste('BOLD',rownames(sera)[c(2,8)])
#rownames(sera)[c(3,5,9)] <- paste('ITALIC',rownames(sera)[c(3,5,9)])
print(xtable(sera), scalebox=0.7,auto=TRUE,type = "html", comment=F)
<style>
table.mytable {
  border: none;
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  line-height: 13px;
  font-family: 'Ubuntu';'Trebuchet MS';
  font-weight: bolder;
  color: #A00F0F;
}

table.mytable tr:nth-child(2n+1) {
  background: #A00F0F; 
  */background: #FFFFFF;*/
}
</style>
```

*** =right
**Sampling**
> - Cluster Sampling
> - Probability Proportional to Size
> - Census 2009
   - Select Sample Size
> - NRT Settlement Mapping
   - Sample Selection
   - Locations/Ward
> - Wet Season (June/November)
> - 2 Weeks
   - Point Person
   - Enumerator Selection and Training
   - Community Awareness
   - Data Collection
   - Payments

<style>#sample li{font-size: 80%}</style>

--- &carousel 

## Enumerator Training and Data Collection

*** {class: active, img: "assets/img/enumerators.jpg"}
Enumerator Training

*** {img: "assets/img/survey.pdf"}
Survey

--- 

## Analysis and Results
**Livelihoods**

```{r lhd_graph, eval=F, echo=FALSE, comment=FALSE, warnings=FALSE, results='asis'}
library(ggplot2)
library(RColorBrewer)
lhd <- read.csv("options.csv")
colourCount = length(unique(lhd$activity))
getPalette = colorRampPalette(brewer.pal(9, "RdGy"))
my_cols <- getPalette(colourCount)
my_cols[1] <- c("#BABABA")

p8 <- ggplot(lhd,aes(x=ccy, y=prop, fill=factor(activity)))
p8 <- p8 +  geom_bar(stat="identity", width=0.5, position="dodge")
p8 <- p8 +    xlab("Activity")
p8 <- p8 +    ylab("Percentage")
p8 <- p8 +  ggtitle("Main Activity Type\n")+ theme(plot.title = element_text(size = 24))
p8 <- p8 +  scale_fill_brewer(palette="my_cols")
p8 <- p8 +  theme_bw() 
p8 <- p8 +  theme(panel.border = element_blank(),
                    panel.grid.major = element_blank(), 
                    panel.grid.minor = element_blank(), 
                    axis.line = element_line(colour = "grey",lineend="butt",size=2))
p8 <- p8 + theme(axis.title.y=element_text(vjust=1.5,family="", size=16, face="bold")) 
p8 <- p8 + theme(axis.title.x=element_text(vjust=-1,family="", size=16, face="bold")) 
p8 <- p8 +  theme(axis.text=element_text(family="", size=14, face="bold"))
p8 <- p8 + theme(axis.text.x = element_text(angle=90, vjust=0.4, hjust=1, size=14)) 
p8 <- p8  + theme(legend.title=element_blank())
p8 <- p8 +  theme(legend.text=element_text(size=14))
#p8 <- p8 +  theme(legend.position=c(0.9, 0.3))
#p8 <- p8 +  scale_y_continuous(expand=c(0,0)) 
p8
```

```{r nvd3plot1, echo=FALSE, cache = F, results ='asis'}
require(rCharts)
lhd <- read.csv("options.csv")
lhd = as.data.frame(lhd)
n1 <- nPlot( prop ~ccy, group = 'activity', type = 'multiBarChart',
  data = lhd)
n1$chart(reduceXTicks = FALSE)
n1$xAxis(rotateLabels=-90)
#n1$print('chart1', cdn=TRUE)
n1$save('livelihoods.html', cdn = TRUE)
```
```{r livelihoods1, results = 'asis', cache = F, comment = NA, message = F, echo = F}
#d1$show('inline')
n1$show('iframe', cdn = TRUE)
```

<style>iframe{width:100%, height:400px;}</style>

--- &carousel

## Assets

*** {class: active, img: "assets/img/avg_livestock.jpg"}
Average Livestock Numbers: Namunyak

*** {img: "assets/img/no_livestock.jpg"}
Households with No Livestock: Namunyak



--- #myslide

## Analysis and Results

<div>
<iframe src="https://dgohil.shinyapps.io/app2/", width=500, height=600></iframe>
</div>

---

## Wildlife: Conflict Types

```{r nvd3plot2, echo=F,results='asis', cache = F}
require(rCharts)
c <- read.csv("p_type.csv")
c = as.data.frame(c)
n2 <- nPlot( prop ~ccy, group = 'conflict', type = 'multiBarChart',
  data = c)
n2$chart(reduceXTicks = FALSE)
n2$xAxis(rotateLabels=-90)
n2$save('conflict.html', cdn = TRUE)
#n2$print('chart2')
```
```{r wildlife1, results = 'asis', cache = F, comment = NA, message = F, echo = F}
#d1$show('inline')
n2$show('iframe', cdn = TRUE)
```

<style>iframe{width:100%, height:400px;}</style>

---

## Security: Conflict Types

```{r nvd3plot3, echo=FALSE,cache = F, results ='asis'}
require(rCharts)
security <- read.csv("sec_status.csv")
security = as.data.frame(security)
n3 <- nPlot( prop ~ccy, group = 'sec', type = 'multiBarChart', data = security)
n3$chart(reduceXTicks = FALSE)
n3$xAxis(rotateLabels=-90)
n3$print('chart1')
#n3$save('security.html', cdn = TRUE)
#n3$show('security.html', cdn = TRUE, standalone=TRUE)
```
```{r security1, results = 'asis', cache = F, comment = NA, message = F, echo = F}
#d1$show('inline')
#n3$show('iframe', cdn = TRUE)
```

<style>iframe{width:100%, height:650px;}</style>

---

## Choroplethic Governance Map
```{r choroplethic_map, echo=FALSE, message=FALSE, comment=FALSE, warning=FALSE, cache=F}
# Get data
library(plyr)
library(XLConnect)
gov <- loadWorkbook("~/Documents/NRT/scomms/Github/scomms_presentation/slides/gov_scores.xlsx")
gov1 <- readWorksheet(gov, 1)
# Do not convert data to factor. ichoropleth only recognizes numeric or character data

library(rgdal)
# "GeoJSON" %in% ogrDrivers()$name
# ogrDrivers() checks whether the drivers are present

# The dbf from the state shapefile needed to merge with the df state_code and names
library(foreign)
codes <- read.dbf("states1.dbf")
#names(codes)
codes$NOM_ENT <- iconv(codes$NOM_ENT, "windows-1252", "utf-8")
codes$CVE_ENT <- as.numeric(codes$CVE_ENT)
codes$OID <- NULL
names(codes) <- c("state_code","area", "name", "pop","yr_reg","area_km")

# Replace all spaces in state names with "_" in the topojson file
library(stringr)
con <- file("ccy.json", "r") # get an incomplete final line error.
tpjson <- readLines(con)
close(con)
for(i in 1:19) {
  tpjson <- str_replace_all(tpjson, codes$name[i],
                            str_replace_all(codes$name[i], " ", "_"))
}

# Sum performance_score by conservancy,nrt_area etc and group by conservancy and nrt_area and year
# We first need make reshape the data to make it "long". This will allow us to crete dropdown menu to change
# the data that displays.

library(reshape)
gov2 <- reshape(gov1,
                varying=c("registration",
                          "agm",
                          "community_support",
                          "board_rotation",
                          "hr_procedures",
                          "annual_audit",
                          "budget_process",
                          "budget_execution",
                          "revenue_sharing_bylaws",
                          "revenue_publication",
                          "quarterly_reporting",
                          "fundraising",
                          "donor_relations",
                          "asset_management",
                          "partnerships",
                          "performance_score"),
                v.names="gov_score",
                timevar="gov_parameter",
                times=c("registration",
                        "agm",
                        "community_support",
                        "board_rotation",
                        "hr_procedures",
                        "annual_audit",
                        "budget_process",
                        "budget_execution",
                        "revenue_sharing_bylaws",
                        "revenue_publication",
                        "quarterly_reporting",
                        "fundraising",
                        "donor_relations",
                        "asset_management",
                        "partnerships",
                        "performance_score"),
                direction="long")


library(data.table) # For below setnames command
setnames(gov2, "conservancy", "name")

# Subsets for only performance_score
gov3 <- subset(gov2, gov_parameter == "performance_score")

library(dplyr)
gov_all <- gov3 %>%
  filter(year %in% 2012:2014) %>% 
  group_by(nrt_area, name, year) %>%
  arrange(name)

# Names needed for the map
gov_final <- plyr::join(gov_all, codes)

# Cut the data into quantiles
gov_map <- transform(gov_all,
                     fillKey = cut(gov_score, breaks = 5, labels = LETTERS[1:5])
)


# Associate fill colors
library(RColorBrewer)
colourCount = 5
getPalette = colorRampPalette(brewer.pal(9, "Reds"))
my_cols <- rev(getPalette(colourCount)) # if you want to reverse palette
#my_cols <- getPalette(colourCount)
my_cols[6] <- c("#E5E5E5") # Greys out areas where there's no data

library(RColorBrewer)
fills = setNames(
  c(my_cols),
  c(levels(gov_map$fillKey), 'defaultFill')
)

gov_map1 <- plyr::dlply((gov_map), "year", function(x){
  y = rCharts::toJSONArray2(x, json = F)
  names(y) = lapply(y, '[[', 'name')
  return(y)
})

```

```{r map_setp, eval=FALSE,cache=F, message = F, echo=F, results = 'asis', comment = NA}
# Below code creates the animated choropleth map
library(rMaps)
options(RMAP_WIDTH = 600, RMAP_HEIGHT = 800)
knitr::opts_chunk$set(comment = NA, results = 'asis', tidy = F, message = F)
```

```{r ch1, cache=F, message = F, echo=F, results = 'asis', comment = NA, fig.height = 8, fig.width = 6}
library(rMaps)
d1 <- Datamaps$new()
d1$set(
  geographyConfig = list(
    dataUrl = "ccy.json",
    popupTemplate =  "#! function(geography, data) { //this function should just return a string
    return '<div class=hoverinfo><strong>' + geography.properties.name + '</strong></div>';
    }  !#"
  ),
  dom='chart_1',
  scope = 'states1',
  labels=TRUE,
  bodyattrs = "ng-app ng-controller=rChartsCtrl",  
  setProjection = '#! function( element, options ) {
  var projection, path;
  projection = d3.geo.mercator()
  .center([38.5, 1.3]) //centers the map on the conservancies
  .scale(10000) // makes it larger
  .translate([element.offsetWidth / 2, element.offsetHeight / 2]);
  
  path = d3.geo.path().projection( projection );
  
  return {path: path, projection: projection};
  
  } !#',
  fills = fills,
  data = gov_map1[[1]],
  legend = TRUE,
  labels = TRUE
)
d1$save('governance.html', cdn = TRUE)

d1$addAssets(
  jshead = "http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js"
)
d1$setTemplate(chartDiv = "
               <div class='container'>
               <input id='slider' type='range' min=2012 max=2014 ng-model='year' width=200>
               <span ng-bind='year'></span>
               <div id = 'chart_1' class = 'rChart datamaps'>
               <script>
               function rChartsCtrl($scope){
               $scope.year = '2012';
               $scope.$watch('year', function(newYear){
               mapchart_1.updateChoropleth(chartParams.newData[newYear]);
               })
               }
               </script>
               </div>   "
)
d1$set(newData = gov_map1)
d1$save("governance.html", cdn = TRUE, standalone=TRUE)
#cat('<iframe src="governance.html" width=100%, height=600></iframe>')
#d1$show('inline')
```
```{r ch2, results = 'asis', comment = NA, message = F, echo = F}
#d1$show('inline')
d1$show('iframe', cdn = TRUE)
#<style>iframe{width:100%, height:400px;}</style>
#d1$print('chart1')
```
file:///Users/dgohil/Documents/NRT/scomms/Github/governance_ppt/slides/governance.html
---

## Questions?

**Who should use the data?**
 - NRT
 - Conservancy Management and Boards
 - Government
 - Conservation and Development Stakeholders

**What should they do with it?**
 - Action Plans
 - Development Plans/Vision
 - Monitoring Impact

--- &twocol_48 #action 

## Action Plans

*** =left

Use Data

Community and Conservancy Management and Development Plans

- Natural Resources
 - Increasing
 - Forests
 - Rangelands
 - Water
- Human Development
 - Poverty
 - Livelihoods
 - Education
 - Health
- Security
 - Poaching
 - Cattle Rustling

<style>#action li{font-size: 70%}</style>
   
*** =right
![ccdmp](assets/img/ccdmp.pdf)
<img width=100px height=200px src=''assets/img/ccdmp.pdf"></img>


--- {
tpl: thankyou
}

## Thank You

For more information you can contact:

Deepali Gohil

+254 702 788 055

deepali.gohil@nrt-kenya.org



















